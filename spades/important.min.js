function $gamify(e){return{arr:e,each:function(e){for(var t=0;t<this.arr.length;t++){e.call(this.arr,this.arr[t])}},any:function(e){for(var t=0;t<this.arr.length;t++){if(e.call(this.arr,this.arr[t])){return true}}return false},max:function(e){var t=null;for(var n=0;n<this.arr.length;n++){var r=e.call(this.arr,this.arr[n]);if(t===null){t=r}else if(r>=t){t=r}}return t},random:function(){return this.arr[Math.floor(Math.random()*this.arr.length)]},where:function(e){var t=[];for(var n=0;n<this.arr.length;n++){var r=this.arr[n];if(e(r)){t.push(r)}}return t},count:function(e){var t=0;for(var n=0;n<this.arr.length;n++){if(e.call(this.arr,this.arr[n])){t++}}return t},all:function(e){for(var t=0;t<this.arr.length;t++){if(!e.call(this.arr,this.arr[t])){return false}}return true},remove:function(e){for(var t=0;t<this.arr.length;t++){if(this.arr[t]==e){this.arr.splice(t,1);return true}}return false},last:function(){if(!this.arr.length){return null}return this.arr[this.arr.length-1]},indexOf:function(e){for(var t=0;t<this.arr.length;t++){if(this.arr[t]==e){return t}}return-1},contains:function(e){return this.indexOf(e)!=-1}}}function handleError(e){throw e}function log(e){if(typeof WScript=="object"){WScript.Echo(e)}}function trace(e){log(e)}function Card(e,t){this.init(e,t)}function CardGame(){this.initDefaults()}function Spades(){CardGame.prototype.create(this);this.init()}function createGame(){return new Spades}function ComputerPlayer(e){this.init(e)}function HumanPlayer(e){this.init(e)}function showCards(e,t,n){setTimeout(function(){for(var n=0;n<e.length;n++){e[n].showCard(t)}},n||ANIMATION_SPEED/2)}function hideCards(e,t,n){setTimeout(function(){for(var n=0;n<e.length;n++){e[n].hideCard(t)}},n||ANIMATION_SPEED/2)}function showPage(e){$(".inner-page").hide();$(e+"-page").show();trackEvent("Page",e.substr(1,1).toUpperCase()+e.substr(2))}function WebCardGame(){}function loadSocialScripts(){var e,t=document.getElementsByTagName("script")[0];e=document.createElement("script");e.async=true;$.getScript("https://apis.google.com/js/plusone.js");$.getScript("http://platform.twitter.com/widgets.js")}function WebSpades(){}var errorHandling=true;trace.enabled=false;Card.prototype={playable:false,init:function(e,t){this.shortName=e+t;this.suit=e;this.rank=t;if(e=="bj"){this.longName="black joker";this.shortName="BJ";return}else if(e=="rj"){this.longName="red joker";this.shortName="RJ";return}var n={h:"hearts",s:"spades",d:"diamonds",c:"clubs"};var r={11:"jack",12:"queen",13:"king",1:"ace",14:"ace"};if(r[t]){this.longName=r[t]+" of "+n[e]}else{this.longName=t+" of "+n[e]}this.shortName=this.suit.toUpperCase()+this.rank},toString:function(){return this.shortName},rankName:function(){var e=[null,null,"a two","a three","a four","a five","a six","a seven","an eight","a nine","a ten","a jack","a queen","a king","an ace"];return e[this.rank]},shortRankName:function(){var e=[null,null,"two","three","four","five","six","seven","eight","nine","ten","jack","queen","king","ace"];return e[this.rank]},suitName:function(){var e={h:"heart",s:"spade",d:"diamond",c:"club"};return e[this.suit]}};CardGame.prototype={cardCount:8,enableRendering:true,defaultPlayerCount:2,useBlackJoker:false,useRedJoker:false,acesHigh:true,makeRenderFunc:function(format){return function(e){with(e){var msg=eval(format.replace(/@(\w+(\.\w+)*)/g,"'+$1+'").replace(/(.*)/,"'$1'"));log(msg)}e.game.callbackQueue.push(e)}},initDefaults:function(){this.callbackQueue=[];this.renderers={};this.renderers["deckready"]=this.makeRenderFunc("deckready");this.renderers["dealcard"]=this.makeRenderFunc("dealcard - @card - @player.name - hand: @player.hand");this.renderers["selectcard"]=this.makeRenderFunc("selectcard - @card - @player.name");this.renderers["unselectcard"]=this.makeRenderFunc("unselectcard - @card - @player.name");this.renderers["start"]=this.makeRenderFunc("start");this.renderers["playerturn"]=this.makeRenderFunc("playerturn - @player.name");this.renderers["play"]=this.makeRenderFunc("play - @player.name played @cards - hand: @player.hand");this.renderers["draw"]=this.makeRenderFunc("draw - @card - @player.name");this.renderers["pass"]=this.makeRenderFunc("pass - @player.name");this.renderers["win"]=this.makeRenderFunc("win - @player.name");this.renderers["sorthand"]=this.makeRenderFunc("sorthand - @player.name - @player.hand");this.renderers["pickdealer"]=this.makeRenderFunc("pickdealer - @player.name");this.players=[]},runInConsole:function(){this.start();//var e=["Mr. Carter","Bush","Alice","Alex","Christy","Sarah","William"];
for(var t=0;t<this.defaultPlayerCount;t++){this.addPlayer(new ComputerPlayer(e[t]))}this.deal();while(this.callbackQueue.length>0){var n=this.callbackQueue.splice(0,1)[0];n.callback()}},message:function(e){},renderEvent:function(e,t,n){if(!n){n={}}if(!n.player){n.player=this.currentPlayer()}n.name=e;n.game=this;var r=this;n.callback=function(){if(errorHandling){try{t.call(r)}catch(e){handleError(e)}}else{t.call(r)}};if(this.enableRendering){if(errorHandling){try{this.renderers[e](n)}catch(i){handleError(i)}}else{this.renderers[e](n)}}else{n.callback()}},setEventRenderer:function(e,t){this.renderers[e]=t},getPlayableCards:function(e){var t=[];$gamify(e.hand).each(function(e){if(e.playable){t.push(e)}});return t},players:null,deck:null,pile:null,currentPlayerIndex:0,playCards:function(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(!this.canPlayCard(e,r)){throw"Illegal card from "+e.name+", "+r}this.pile.push(r);r.selected=false;if(!e.remove(r)){throw"Card "+r+" is not held by player "+e.name}}e.selectedCards=[];e.canPlay=false;this.renderEvent("play",this.afterPlayCards,{cards:t})},afterPlayCards:function(){this.nextPlayerTurn()},selectCard:function(e,t,n){if(!e.hasCard(t)){throw"Player can't select a card he doesn't hold!"}if(t.selected){throw"Card is already selected!"}if(e.selectedCards===this.undefined){e.selectedCards=[]}t.selected=true;e.selectedCards.push(t);this.renderEvent("selectcard",n||function(){},{card:t,player:e})},unselectCard:function(e,t){if(!e.hasCard(t)){throw"Player can't unselect a card he doesn't hold!"}if(!t.selected){throw"Card is not selected!"}t.selected=false;$gamify(e.selectedCards).remove(t);this.renderEvent("unselectcard",function(){},{card:t,player:e})},sortHand:function(e,t,n){if(!e.hand){return}var r=function(t,n){if(e.handSorted=="ASC"){return n-t}return t-n};if(this.sortType=="suit"){e.hand.sort(function(e,t){var n={h:0,s:1,d:2,c:3};if(e.suit==t.suit){return r(e.rank,t.rank)}return r(n[e.suit],n[t.suit])})}else if(this.sortType=="rank"){e.hand.sort(function(e,t){var n={h:0,s:1,d:2,c:3};if(e.rank==t.rank){return r(n[e.suit],n[t.suit])}return r(e.rank,t.rank)})}e.handSorted=e.handSorted=="ASC"?"DESC":"ASC";if(!n){this.renderEvent("sorthand",t||function(){})}},drawCard:function(e){e.hand.push(this.deck.pop());e.handSorted=false;e.canPlay=false;this.renderEvent("draw",this.playerPlay,{card:$gamify(e.hand).last(),cardpos:e.hand.length-1})},currentPlayerTurn:function(){this.beforePlayerTurn(this.currentPlayer());this.renderEvent("playerturn",this.playerPlay)},playerDraw:function(e){e.draw()},playerPlay:function(){var e=this.currentPlayer();var t=[];for(var n=0;n<e.hand.length;n++){var r=e.hand[n];r.playable=this.canPlayCard(e,r);if(r.playable){t.push(r)}}e.canPlay=true;e.hasPlayableCards=t.length>0;if(t.length==0){if(this.mustSayPass(e)){this.renderEvent("pass",this.nextPlayerTurn)}else if(this.mustDraw(e)){this.playerDraw(e)}else{throw"Game must implement mustSayPass or mustDraw correctly"}}else{this.currentPlayer().play(t)}},nextPlayerTurn:function(){var e=this.currentPlayer();if(this.hasWon(e)){this.message(e.name+" wins!");this.renderEvent("win",function(){})}else{this.currentPlayerIndex=this.pickNextPlayerIndex();if(this.isNewRoundStarting()){this.round++}this.currentPlayerTurn()}},addPlayer:function(e){e.game=this;e.pos=this.players.length;this.players.push(e)},getNextPlayer:function(e){var t=$gamify(this.players).indexOf(e);return this.players[this.nextIndex(t)]},start:function(){this.pile=[];this.round=0;this.newDeck()},afterDealing:function(){this.currentPlayerIndex=this.pickFirstPlayerIndex();this.renderEvent("start",this.currentPlayerTurn)},currentPlayer:function(){return this.players[this.currentPlayerIndex]},newDeck:function(){this.deck=[];var e=this.acesHigh?2:1;var t=e+12;for(var n=e;n<=t;n++){this.deck.push(new Card("h",n));this.deck.push(new Card("s",n));this.deck.push(new Card("d",n));this.deck.push(new Card("c",n))}if(this.useBlackJoker){this.deck.push(new Card("bj",0))}if(this.useRedJoker){this.deck.push(new Card("rj",0))}this.shuffle(this.deck);this.renderEvent("deckready",function(){})},shuffle:function(e){var t=e.length;if(t==0)return;while(--t){var n=Math.floor(Math.random()*(t+1));var r=e[t];var i=e[n];e[t]=i;e[n]=r}},dealtCardCount:0,nextPlayerToDealTo:0,dealerIndex:-1,lastDealerIndex:-1,deal:function(){if(this.dealerIndex==-1){this.dealerIndex=this.pickDealerIndex();this.nextPlayerToDealTo=this.nextIndex(this.dealerIndex);this.renderEvent("pickdealer",this.deal,{player:this.players[this.dealerIndex]});return}if(this.dealtCardCount==this.cardCount*this.players.length){this.afterDealing()}else{var e=this.deck.pop();var t=this.players[this.nextPlayerToDealTo];t.hand.push(e);this.nextPlayerToDealTo=this.nextIndex(this.nextPlayerToDealTo);this.dealtCardCount++;this.renderEvent("dealcard",this.deal,{player:t,cardpos:t.hand.length-1,card:e})}},create:function(e){for(var t in this){if(!e[t]){e[t]=this[t]}}e.base=this},pickDealerIndex:function(){if(this.lastDealerIndex>=0){return this.nextIndex(this.lastDealerIndex)}else{return Math.floor(Math.random()*this.players.length)}},pickFirstPlayerIndex:function(){return this.nextIndex(this.dealerIndex)},hasWon:function(e){return false},beforePlayerTurn:function(e){},canPlayCard:function(e,t){return true},canSelectCard:function(e,t){return true},mustSayPass:function(e){return false},mustDraw:function(e){return false},nextIndex:function(e){return(e+1)%this.players.length},pickNextPlayerIndex:function(){return this.nextIndex(this.currentPlayerIndex)},isNewRoundStarting:function(){return this.currentPlayerIndex==0}};Spades.prototype={cardCount:13,sortType:"suit",canSelectCards:false,defaultPlayerCount:4,spadesIsBroken:false,previousGameScores:null,init:function(){this.initDefaults();this.renderers["spadesbroken"]=this.makeRenderFunc("spadesbroken - @player.name breaks spades");this.renderers["taketrick"]=this.makeRenderFunc("taketrick - @player.name takes the trick");this.renderers["bid"]=this.makeRenderFunc("bid - @player.name bids @bid");this.renderers["showscore"]=this.makeRenderFunc("showscore")},toString:function(){return"Spades"},canPlayCard:function(e,t){if(this.pile.length==0){if(t.suit!="s"){return true}return this.spadesIsBroken||$gamify(e.hand).all(function(e){return e.suit=="s"})}var n=this.pile[0].suit;return t.suit==n||!$gamify(e.hand).any(function(e){return e.suit==n})},canSelectCard:function(e,t){return this.canPlayCard(e,t)},afterDealing:function(){for(var e=0;e<this.players.length;e++){var t=this.players[e];if(t.isHuman&&!t.handSorted){return this.sortHand(t,this.afterDealing)}}$gamify(this.players).each(function(e){e.tricks=[];e.bidValue=-1});for(var e=0;e<this.players.length;e++){this.players[e].partner=this.players[(e+2)%this.players.length]}for(var e=0;e<this.players.length;e++){if(this.players[e].beforeGameStart){this.players[e].beforeGameStart()}}this.currentPlayerIndex=this.pickFirstPlayerIndex();this.bidPlayerIndex=this.currentPlayerIndex;this.players[this.bidPlayerIndex].bid()},bid:function(e,t){e.bidValue=t;this.renderEvent("bid",this.afterRenderBid,{player:e,bid:t})},afterRenderBid:function(){if($gamify(this.players).all(function(e){return e.bidValue>=0})){this.renderEvent("start",this.currentPlayerTurn)}else{this.bidPlayerIndex=(this.bidPlayerIndex+1)%this.players.length;this.players[this.bidPlayerIndex].bid()}},beforePlayerTurn:function(e){},playCards:function(e,t){if(t[0].suit=="s"&&!this.spadesIsBroken){this.spadesIsBroken=true;this.renderEvent("spadesbroken",function(){})}for(var n=0;n<this.players.length;n++){this.players[n].notifyPlay(this.pile,e,t[0])}this.base.playCards.call(this,e,t)},playerPlay:function(){this.base.playerPlay.call(this)},calculateScore:function(){function e(e,t){var n={bid:e.bidValue+t.bidValue,tricks:0,bagsPrevRound:e.bags||0,bags:0,totalBags:0,bagsNextRound:0,nilBidScore:0,nilBidPenalty:0,bagsScore:0,bagsPenalty:0,tricksScore:0,tricksPenalty:0,score:0,scoreLastRound:e.scoreLastRound||0,scoreTotal:0};var r=100;var i=10;var s=1;var o=100;var u=[e,t];for(var a in u){var f=u[a];if(f.bidValue==0&&f.tricks.length==0){n.nilBidScore+=r}else if(f.bidValue==0&&f.tricks.length>0){n.nilBidPenalty-=r;n.bags+=f.tricks.length}else{n.tricks+=f.tricks.length}}if(n.tricks>=n.bid){n.bags+=n.tricks-n.bid;n.totalBags=n.bags+n.bagsPrevRound;n.bagsNextRound=n.totalBags;n.bagsScore+=n.tricks-n.bid;n.tricksScore+=n.bid*i;if(n.bagsNextRound>=10){n.bagsPenalty-=o;n.bagsNextRound-=10}}else{n.tricksPenalty-=n.bid*i}n.score=n.tricksScore+n.tricksPenalty+n.bagsScore+n.bagsPenalty+n.nilBidScore+n.nilBidPenalty;n.scoreTotal=n.score+n.scoreLastRound;return n}var t=e(this.players[0],this.players[2]);var n=e(this.players[1],this.players[3]);var r=500;if(t.scoreTotal<r&&n.scoreTotal<r||t.scoreTotal>=r&&t.score==n.score){this.renderEvent("showscore",function(){},{team1:t,team2:n})}else if(t.scoreTotal>=r&&t.scoreTotal>n.scoreTotal){this.renderEvent("win",function(){},{team1:t,team2:n,winner:1})}else if(n.scoreTotal>=r){this.renderEvent("win",function(){},{team1:t,team2:n,winner:2})}else{alert("someth "+t.scoreTotal)}},afterPlayCards:function(){if(this.pile.length<this.players.length){this.nextPlayerTurn()}else{var e=0;var t=this.pile[0];var n=t;var r=(this.currentPlayerIndex+1)%this.players.length;for(var i=1;i<this.pile.length;i++){var s=this.pile[i];if(n.suit!="s"&&s.suit=="s"){n=s;e=i}else if(s.suit==n.suit&&s.rank>n.rank){n=s;e=i}}var o=(r+e)%this.players.length;var u=this.players[0].hand.length==0;this.currentPlayerIndex=o;this.currentPlayer().tricks.push(this.pile.slice(0));var a=this.pile;this.pile=[];var f=!u?this.currentPlayerTurn:this.calculateScore;this.renderEvent("taketrick",f,{trick:a})}}};var INTELLIGENT=0;var RANDOM=1;var EVIL=2;var INTELLIGENT_AND_EVIL=3;ComputerPlayer.prototype={name:null,hand:null,strategy:INTELLIGENT,isHuman:false,init:function(e){this.name=e;this.hand=[];this.selectedCards=[]},play:function(e){var t=e[Math.floor(Math.random()*e.length)];var n=[t];this.game.playCards(this,n)},draw:function(){this.game.drawCard(this)},extend:function(e){this.base={};for(var t in e){if(this[t]){this.base[t]=this[t]}this[t]=e[t]}if(e.hasOwnProperty("toString")){this.toString=e.toString}},toString:function(){var e=this.name;if(this.hand.length){e+=" - HAND: "+this.hand}return e},hasCard:function(e){return $gamify(this.hand).contains(e)},remove:function(e){return $gamify(this.hand).remove(e)}};ComputerPlayer.prototype.extend({notifyPlay:function(e,t,n){if(e.length>0&&e[0].suit!=n.suit){this.playerInfo[t.name][e[0].suit]=false}$gamify(this.remaining[n.suit]).remove(n.rank);if(this.remaining[n.suit].length==0){for(var r in this.playerInfo){this.playerInfo[r][n.suit]=false}}},play:function(e){if(this.game.pile.length==0){this.playPos1(e)}else if(this.game.pile.length==1){this.playPos2(e)}else if(this.game.pile.length==2){this.playPos3(e)}else if(this.game.pile.length==3){this.playPos4(e)}},playPos1:function(e){var t=$gamify(this.game.players).indexOf(this);var n=this.game.players[(t+1)%4];var r=this.game.players[(t+3)%4];var i=this.partner;for(var s in e){var o=e[s];o.goodness=0;for(var u in this.remaining[o.suit]){if(this.remaining[o.suit][u]>o.rank){o.goodness--}}if(this.playerInfo[i.name][o.suit]==false&&o.goodness<0){o.goodness-=1e3}if(this.playerInfo[n.name][o.suit]==false&&this.playerInfo[n.name]["s"]==false&&this.playerInfo[r.name][o.suit]==false&&this.playerInfo[r.name]["s"]==false){o.goodness+=1e3}if(this.playerInfo[n.name][o.suit]==false){o.goodness+=2;if(this.playerInfo[n.name]["s"]==false){o.goodness+=3}}if(this.playerInfo[r.name][o.suit]==false){o.goodness+=2;if(this.playerInfo[n.name]["s"]==false){o.goodness+=3}}}e.sort(function(e,t){return e.goodness-t.goodness});var a=e[e.length-1];var f=e[0];if(this.bidValue==0){this.playCard(f)}else{this.playCard(a)}},playPos2:function(e){this.sortPlayable(e);var t=e[0];var n=e[e.length-1];if(this.bidValue==0){this.playCard(t)}else{if(this.canWinCard(n,this.game.pile[0])){this.playCard(n)}else{this.playCard(t)}}},sortPlayable:function(e){e.sort(function(e,t){if(e.suit!="s"&&t.suit=="s"){return-1}else if(e.suit=="s"&&t.suit!="s"){return 1}return e.rank-t.rank})},playPos3:function(e){this.sortPlayable(e);var t=e[0];var n=e[e.length-1];var r=this.getBestCard();if(this.bidValue==0){this.playCard(t)}else{if(!this.canWinCard(n,this.game.pile[0])){this.playCard(t)}else if(r==this.game.pile[0]&&r.rank>10){this.playCard(t)}else if(r==this.game.pile[1]&&this.canWinCard(n,r)){this.playCard(n)}else if(r==this.game.pile[1]&&!this.canWinCard(n,r)){this.playCard(t)}else{this.playCard(n)}}},playPos4:function(e){this.sortPlayable(e);var t=e[0];var n;var r=this.getBestCard();for(var i=0;i<e.length;i++){if(this.canWinCard(e[i],r)){n=e[i];break}}var s=r==this.game.pile[1];var o=this.partner.bidValue==0&&this.partner.tricks.length==0;var u=this.partner.bidValue==0&&this.partner.tricks.length>0;var a=!!n;if(a){if(this.bidValue==0){if(this.canWinCard(t,r)){this.playCard(e[e.length-1])}else{for(var i=0;i<e.length;i++){if(this.canWinCard(e[i+1],r)){this.playCard(e[i])}}}}else{if(s){if(this.partner.bidValue==0){this.playCard(n)}else{this.playCard(t)}}else{this.playCard(n)}}}else{if(this.bidValue==0){this.playCard(e[e.length-1])}else{this.playCard(t)}}},playCard:function(e){this.game.playCards(this,[e])},canWinCard:function(e,t){return e.suit==t.suit&&e.rank>t.rank||e.suit=="s"&&t.suit!="s"},getBestCard:function(){var e=this.game.pile[0];for(var t=1;t<this.game.pile.length;t++){var n=this.game.pile[t];if(this.canWinCard(n,e)){e=n}}return e},beforeGameStart:function(){this.remaining={};var e=["h","s","d","c"];for(var t in e){this.remaining[e[t]]=[2,3,4,5,6,7,8,9,10,11,12,13,14]}for(var t in this.hand){var n=this.hand[t];$gamify(this.remaining[n.suit]).remove(n.rank)}this.playerInfo={};for(var t=0;t<this.game.players.length;t++){var r=this.game.players[t];this.playerInfo[r.name]={h:true,s:true,d:true,c:true}}},bid:function(){var e=0;for(var t=0;t<this.hand.length;t++){var n=this.hand[t];if(n.rank>12||n.suit=="s"&&n.rank>9){e++}}e=Math.min(e,6);e=Math.max(e,1);if(this.partner.bidValue>6){e=1}else if(e+this.partner.bidValue>8){e=8-this.partner.bidValue}e=Math.max(e,1);this.game.bid(this,e)}});HumanPlayer.prototype={name:null,hand:null,isHuman:true,canOnlyDraw:false,playable:null,init:function(e){this.name=e;this.hand=[];this.selectedCards=[]},wrongCardMessageIndex:0,play:function(e){this.playable=e},draw:function(){this.canOnlyDraw=true;this.mustDrawMessage()},useCard:function(e,t){if(!e){throw"card was null"}if(t&&!this.game.canSelectCards){return}this.game.message("");if(this.canOnlyDraw){this.drawing(e)}else if(!this.hasCard(e)){this.illegalCardUsed(e,t)}else if(!this.canPlay){this.notYourTurnMessage()}else if(t){this.selecting(e)}else if($gamify(this.playable).contains(e)||this.game.canSelectCard(this,e)){this.playing(e)}else{this.nonPlayableCardUsed(e,t)}},playing:function(e){if($gamify(this.selectedCards).contains(e)){this.game.playCards(this,this.selectedCards)}else if(!this.game.canSelectCard(this,e)){this.cannotSelectCardMessage(e)}else{this.selectedCards.push(e);this.game.playCards(this,this.selectedCards)}},drawing:function(e){if(e==$gamify(this.game.deck).last()){this.game.message("");this.canOnlyDraw=false;this.game.drawCard(this)}else{this.mustDrawMessage()}},selecting:function(e){if(!e.selected){if(this.game.canSelectCard(this,e)){this.game.selectCard(this,e)}else{this.cannotSelectCardMessage(e)}}else{this.game.unselectCard(this,e)}},illegalCardUsed:function(e,t){if(e==$gamify(this.game.deck).last()){this.cannotDrawCardMessage()}else if($gamify(this.game.pile).contains(e)){this.game.message("Hey! No taking cards from the pile!")}else{if(this.wrongCardMessageIndex==this.wrongCardMessages.length){this.game.message("")}else{this.game.message(this.wrongCardMessages[this.wrongCardMessageIndex++])}if(this.wrongCardPressed){this.wrongCardPressed(e.toString())}}},nonPlayableCardUsed:function(e,t){this.cannotPlayCardMessage(e)},wrongCardMessages:[""],notYourTurnMessage:function(){this.game.message("Not quite your turn yet!")},cannotSelectCardMessage:function(e){if(this.selectedCards.length==0){this.cannotPlayCardMessage(e)}else{this.game.message("You cannot play this card with the other cards you have selected.")}},cannotPlayCardMessage:function(e){this.game.message("You cannot play the "+e.longName+" now.")},cannotDrawCardMessage:function(e){this.game.message("You may not draw a card now, you have cards in your hand that you can play!")},mustDrawMessage:function(){this.game.message("You have no cards you can play, you must draw.")},extend:ComputerPlayer.prototype.extend,toString:ComputerPlayer.prototype.toString,hasCard:ComputerPlayer.prototype.hasCard,remove:ComputerPlayer.prototype.remove};HumanPlayer.prototype.extend({init:ComputerPlayer.prototype.init,bid:function(){var e=13;if(this.partner.bidValue>=0){e-=this.partner.bidValue}this.startBid(e);this.isBidding=true},doBid:function(e){this.isBidding=false;this.game.bid(this,e)},notifyPlay:function(e,t,n){},useCard:function(e,t){if(this.isBidding){this.game.message("It's your turn to bid now. You can't play any card while you're bidding!")}else{this.base.useCard.call(this,e,t)}},cannotPlayCardMessage:function(e){if(this.game.pile.length==0){if(e.suit=="s"&&!this.game.spadesIsBroken){this.game.message("Oops! Spades has not yet been broken")}else{throw"Unexpected state"}}else{var t=this.game.pile[0];if($gamify(this.hand).any(function(e){return e.suit==t.suit}))throw"Unexpected state"}}});var TABLE_SIZE={width:700,height:600};var CARD_SIZE={width:71,height:96};var CONDENSE_COUNT=6;var DECK_POS={left:TABLE_SIZE.width/2-1.3*CARD_SIZE.width,top:TABLE_SIZE.height/2-CARD_SIZE.height/2};var PILE_POS={left:DECK_POS.left+1.3*CARD_SIZE.width,top:DECK_POS.top};var CARD_PADDING=18;var HORIZONTAL_MARGIN=60;var VERTICAL_MARGIN=80;var OVERLAY_MARGIN=2;var HORIZONTAL="h";var VERTICAL="v";var LEFT="left",RIGHT="right",TOP="top",BOTTOM="bottom";var BOTTOM_PLAYER_TOP=TABLE_SIZE.height-CARD_SIZE.height-VERTICAL_MARGIN;var TOP_PLAYER_TOP=VERTICAL_MARGIN;var LEFT_PLAYER_TOP=TABLE_SIZE.height/2;var RIGHT_PLAYER_TOP=TABLE_SIZE.height/2;var BOTTOM_PLAYER_LEFT=TABLE_SIZE.width/2;var TOP_PLAYER_LEFT=TABLE_SIZE.width/2;var LEFT_PLAYER_LEFT=HORIZONTAL_MARGIN;var RIGHT_PLAYER_LEFT=TABLE_SIZE.width-CARD_SIZE.height-HORIZONTAL_MARGIN;var ANIMATION_SPEED=500;var TAKE_TRICK_DELAY=750;var zIndexCounter=1;var CARDBACK={x:0,y:-4*CARD_SIZE.height};var HCARDBACK={x:-8*CARD_SIZE.height,y:-5*CARD_SIZE.height};jQuery.fn.moveCard=function(e,t,n,r){var i={};i["top"]=e;i["left"]=t;i["queue"]=false;this.animate(i,r||ANIMATION_SPEED,n);return this};jQuery.fn.sprite=function(e,t){var n={width:t,height:t,"background-position":-e*t+"px 0px"};return this.css(n)};jQuery.fn.setBackground=function(e,t){var n={};n["background-position"]=e+" "+t;this.css(n);return this};Card.prototype.rotate=function(e){$(this.guiCard).css("-webkit-transform","rotate("+e+"deg)").css("-moz-transform","rotate("+e+"deg)").css("-ms-transform","rotate("+e+"deg)").css("transform","rotate("+e+"deg)").css("-o-transform","rotate("+e+"deg)")};Card.prototype.showCard=function(e){var t={c:0,d:1,h:2,s:3};var n,r;if(!e){e=BOTTOM}var i=$(this.guiCard).height(),s=$(this.guiCard).width();if(e==TOP||e==BOTTOM){var o=this.rank;if(o==1){o=14}n=(-o+2)*CARD_SIZE.width;r=-t[this.suit]*CARD_SIZE.height;if(e==TOP&&this.rank>10){n-=4*CARD_SIZE.width}if(this.rank==0){r=-4*CARD_SIZE.height;var u=e==TOP?2:0;if(this.suit=="rj"){n=(-2-u)*CARD_SIZE.width}else if(this.suit=="bj"){n=(-3-u)*CARD_SIZE.width}}if(s>i){$(this.guiCard).height(s).width(i)}this.rotate(0)}else{r=-5*CARD_SIZE.height;var o=this.rank;if(o==1){o=14}if(this.rank==0){n=-8*CARD_SIZE.height;var u=e==RIGHT?0:2;if(this.suit=="rj"){r-=(2+u)*CARD_SIZE.width}else if(this.suit=="bj"){r-=(3+u)*CARD_SIZE.width}}else if(this.rank<=10){r-=(this.rank-2)*CARD_SIZE.width;n=-t[this.suit]*CARD_SIZE.height}else{n=-4*CARD_SIZE.height-t[this.suit]*CARD_SIZE.height;if(e==LEFT){r-=(this.rank-7)*CARD_SIZE.width}else{r-=(this.rank-11)*CARD_SIZE.width}}if(i>s){$(this.guiCard).height(s).width(i)}this.rotate(0)}$(this.guiCard).setBackground(n+"px",r+"px")};Card.prototype.moveToFront=function(){this.guiCard.style.zIndex=zIndexCounter++};Card.prototype.hideCard=function(e){if(!e){e=BOTTOM}var t=$(this.guiCard).height(),n=$(this.guiCard).width();if(e==TOP||e==BOTTOM){$(this.guiCard).setBackground(CARDBACK.x+"px",CARDBACK.y+"px");if(n>t){$(this.guiCard).height(n).width(t)}}else{$(this.guiCard).setBackground(HCARDBACK.x+"px",HCARDBACK.y+"px");if(t>n){$(this.guiCard).height(n).width(t)}}this.rotate(0)};var webRenderer={extend:function(e){this.base={};for(var t in e){if(this[t]){this.base[t]=this[t]}this[t]=e[t]}},deckReady:function(e){var t=DECK_POS.left,n=DECK_POS.top;webRenderer._createCardPile(e.game.deck,DECK_POS.top,DECK_POS.left,false);e.callback()},_createCardPile:function(e,t,n,r){var i=$("#play-page");for(var s=0;s<e.length;s++){var o=e[s];if((s+1)%CONDENSE_COUNT==0){n-=OVERLAY_MARGIN;t-=OVERLAY_MARGIN}webRenderer._createGuiCard(o,{left:n,top:t});if(r){o.showCard()}else{o.hideCard()}}},_createGuiCard:function(e,t){var n=$("#play-page");var r=$("<div>").addClass("card").css(t);n.append(r[0]);e.guiCard=r[0];r[0].card=e;e.moveToFront();e.hideCard()},_getCardPos:function(e,t,n){if(!n){n=e.hand.length}var r=(n-1)*CARD_PADDING+CARD_SIZE.width;var i={};var s=0;if(e.hand[t]&&e.hand[t].selected){s=15}if(e.position==TOP){i.left=e.left+r/2-CARD_SIZE.width-t*CARD_PADDING;i.top=e.top+s}else if(e.position==BOTTOM){i.left=e.left-r/2+t*CARD_PADDING;i.top=e.top-s}else if(e.position==LEFT){i.top=e.top-r/2+t*CARD_PADDING;i.left=e.left+s}else if(e.position==RIGHT){i.top=e.top+r/2-CARD_SIZE.width-t*CARD_PADDING;i.left=e.left-s}return i},dealCard:function(e){webRenderer._adjustHand(e.player,e.callback,ANIMATION_SPEED/2,false,e.game.cardCount)},selectCard:function(e){webRenderer._adjustHand(e.player,e.callback,ANIMATION_SPEED/3)},unselectCard:function(e){webRenderer._adjustHand(e.player,e.callback,ANIMATION_SPEED/3)},pass:function(e){var t=$("#pass");t.css({"font-size":"16px",top:e.player.top,"z-index":zIndexCounter+1e3});if(e.player.position==BOTTOM){t.css("top",e.player.top+100)}var n={top:PILE_POS.top-40,"font-size":"120px"};if(e.player.align==VERTICAL){if(e.player.position==LEFT){t.css({right:"",left:0})}else{t.css({left:"",right:0})}t.css("width","100px");n["width"]=TABLE_SIZE.width}else{t.css("width",TABLE_SIZE.width+"px");t.css("text-align","center")}t.show().animate(n,ANIMATION_SPEED*2).fadeOut(ANIMATION_SPEED,e.callback)},play:function(e){function t(r){if(e.cards.length==0){e.callback()}else{var i=e.player.hand.slice(0);$gamify(e.cards).each(function(e){i.push(e)});i.sort(function(e,t){return $(e.guiCard).css("z-index")-$(t.guiCard).css("z-index")});for(var r=i.length-1;r>=0;r--){$(i[r].guiCard).css("z-index",zIndexCounter+r+1)}zIndexCounter+=i.length+3;var s=e.cards[0];$gamify(e.cards).remove(e.cards[0]);var o=PILE_POS.top-Math.floor((n+r)/CONDENSE_COUNT)*OVERLAY_MARGIN;var u=PILE_POS.left-Math.floor((n+r)/CONDENSE_COUNT)*OVERLAY_MARGIN;$(s.guiCard).moveCard(o,u,function(){t(r+1)});if(e.cards.length==0){webRenderer._adjustHand(e.player,null,ANIMATION_SPEED,true)}showCards([s])}}var n=e.game.pile.length-e.cards.length;if(e.cards.length>1&&$($gamify(e.cards).last().guiCard).css("top")!=$(e.cards[0].guiCard).css("top")){$($gamify(e.cards).last().guiCard).animate({top:$(e.cards[0].guiCard).css("top")},ANIMATION_SPEED/4,function(){t(0)})}else{t(0)}},_adjustHand:function(e,t,n,r,i){if(!n){n=ANIMATION_SPEED}for(var s=0;s<e.hand.length;s++){var o=e.hand[s];var u=webRenderer._getCardPos(e,s,i);var a;if(s==e.hand.length-1){a=t}$(o.guiCard).moveCard(u.top,u.left,a,n);if(!r){o.moveToFront()}}if(e.showCards){showCards(e.hand,e.position,n/2)}else{hideCards(e.hand,e.position,n/2)}},draw:function(e){webRenderer._adjustHand(e.player,e.callback)},sortHand:function(e){webRenderer._adjustHand(e.player,e.callback)},takeTrick:function(e){setTimeout(function(){$gamify(e.trick).each(function(e){$(e.guiCard).addClass("trick")});var t={};var n;var r={};var i=2;var s=45;var o=33;var u=s/2;var f=o/2;var l=10;var c=50;var h=250;var p=i+(c-s)/2;var d=TABLE_SIZE.width/2+c/2+e.player.tricks.length*l;if(e.player.position==TOP){t["left"]=(TABLE_SIZE.width-CARD_SIZE.width)/2+"px";n="verticalTrick";r["top"]=p;r["left"]=d;t=r}else if(e.player.position==BOTTOM){n="verticalTrick";r["bottom"]=i+$("#bottom-player").height()-c+(c-s)/2;r["right"]=d;t["top"]=TABLE_SIZE.height-r["bottom"]-CARD_SIZE.height;t["left"]=TABLE_SIZE.width-r["right"]-CARD_SIZE.width}else if(e.player.position==LEFT){n="horizontalTrick";r["bottom"]=TABLE_SIZE.height-h+e.player.tricks.length*l;r["left"]=p+1;t["top"]=TABLE_SIZE.height-r["bottom"]-CARD_SIZE.height;t["left"]=r["left"]}else if(e.player.position==RIGHT){n="horizontalTrick";r["top"]=h+$("#left-player").height()+e.player.tricks.length*l;r["right"]=p;t["top"]=r["top"];t["left"]=TABLE_SIZE.width-r["right"]-CARD_SIZE.width}for(var v=0;v<e.trick.length;v++){e.trick[v].moveToFront()}for(var v=0;v<e.trick.length;v++){var m=function(){};if(v==e.trick.length-1){m=function(){$(".trick").hide();$("#play-page").append($("<div/>").addClass(n).css(r));if(e.player.isHuman){$("#current-score").text("Your points: "+e.player.points)}e.callback()}}$(e.trick[v].guiCard).animate(t,ANIMATION_SPEED,m)}},TAKE_TRICK_DELAY)}};webRenderer.extend({dealCard:function(e){ANIMATION_SPEED=100;webRenderer.base.dealCard.call(webRenderer,e);ANIMATION_SPEED=500},bid:function(e){var t="#"+e.player.id+" small";var n=$(t).html();var n=$(t).html(n+" ("+e.bid+")");var r="#"+e.player.id+"-bubble";$(r+" p").text("I bid "+e.bid);$(r).fadeIn();setTimeout(e.callback,1e3)},showScore:function(e){function t(e,t){return Math.floor(Math.random()*(t-e+1))+e}$("#message_box").hide();$("#result-box").show();var n=[e.team1,e.team2];if(e.team1.score>=e.team2.score){$("#result-header").text("Congratulations, you won this hand!")}else{$("#result-header").text("Lost this hand - get 'em next time")}for(var r=0;r<=1;r++){var i=n[r];var s=r==0?".tier-1":".tier-2";$("#combined-bid "+s).text(i.bid);$("#tricks-taken "+s).text(i.tricks);$("#bags "+s).text(i.bags);$("#bags-last-round "+s).text(i.bagsPrevRound);$("#bags-total "+s).text(i.totalBags);$("#successful-bid "+s).text(i.tricksScore);$("#failed-bid "+s).text(i.tricksPenalty);$("#successful-nil-bid "+s).text(i.nilBidScore);$("#failed-nil-bid "+s).text(i.nilBidPenalty);$("#bag-score "+s).text(i.bagsScore);$("#bag-penalty "+s).text(i.bagsPenalty);$("#points-this-round "+s).text(i.score);$("#points-last-round "+s).text(i.scoreLastRound);$("#points-total "+s).text(i.scoreTotal)}var o=t(1,4);$("#promo #p"+o).show();var u=e.team1,a=e.team2;if(u.tricksScore==0&&a.tricksScore==0){$("#successful-bid").hide()}if(u.tricksPenalty==0&&a.tricksPenalty==0){$("#failed-bid").hide()}if(u.nilBidScore==0&&a.nilBidScore==0){$("#successful-nil-bid").hide()}if(u.nilBidPenalty==0&&a.nilBidPenalty==0){$("#failed-nil-bid").hide()}if(u.bagsScore==0&&a.bagsScore==0){$("#bag-score").hide()}if(u.bagsPenalty==0&&a.bagsPenalty==0){$("#bag-penalty").hide()}if(e.winner){$("#start-new-game").hide();$("#reset-game").hide();$("#start-new-tournament").show();$("#winner-pics").show();if(e.winner==1){$("#winner1").sprite(human.imgIndex,50);$("#winner2").sprite(topPlayer.imgIndex,50);$("#result-header").text("");$("#facebook-prompt").show();$("#results-table").hide()}else{$("#winner1").sprite(leftPlayer.imgIndex,50);$("#winner2").sprite(rightPlayer.imgIndex,50);$("#result-header").text("Putin and Bush won... Get em next time")}}var f=$("#play-page").height();var l=$("#result-box").height();var c=$("#play-page").width();var h=$("#result-box").width();$("#result-box").css("left",parseInt((c-h)/2));$("#result-box").css("top",parseInt((f-l)/2));e.callback()},win:function(e){e.callback()},spadesBroken:function(e){game.message("Spades has been broken!");$("#spade_large").show().delay(300).hide("explode",{pieces:8});e.callback()},play:function(e){PILE_POS.left=(TABLE_SIZE.width-CARD_SIZE.width)/2;PILE_POS.top=(TABLE_SIZE.height-CARD_SIZE.height)/2;if(e.player.position==TOP){PILE_POS.top-=60}else if(e.player.position==BOTTOM){PILE_POS.top+=10}else if(e.player.position==LEFT){PILE_POS.left-=40;PILE_POS.top-=25}else if(e.player.position==RIGHT){PILE_POS.left+=40;PILE_POS.top-=25}webRenderer.base.play(e)}});WebCardGame.prototype={createGameObject:function(){throw"Game must override createGameObject!"},initPageNavigation:function(){$("#menu li a").click(function(e){showPage($(this).attr("href"))});if(location.hash=="#rules"||location.hash=="#about"||location.hash=="#terms"){showPage(location.hash)}else{$("#play-page").show()}},setupPlayerPicker:function(){var e=13;$("#open-player-picker").click(function(){$("#player-picker").sprite(human.imgIndex,120);$("#change-player").css("zIndex",++zIndexCounter).show()});$("#next-image").click(function(){human.imgIndex=(human.imgIndex+1)%e;if(human.imgIndex==1||human.imgIndex==2||human.imgIndex==3){human.imgIndex=4}$("#player-picker").sprite(human.imgIndex,120)});$("#prev-image").click(function(){human.imgIndex--;if(human.imgIndex==-1){human.imgIndex=e}if(human.imgIndex==1||human.imgIndex==2||human.imgIndex==3){human.imgIndex=0}$("#player-picker").sprite(human.imgIndex,120)});$("#save-image").click(function(){$("#bottom-player div").sprite(human.imgIndex,50);$("#change-player").hide();trackEvent("Customization","ChangePlayer",""+human.imgIndex);$.cookie("player-image",human.imgIndex,{expires:365})});$("#open-player-picker").click(function(){$("#change-player").css("zIndex",++zIndexCounter).show()})},createHumanPlayer:function(){if(location.search&&location.search.indexOf("autoplay")!=-1){human=new ComputerPlayer("You");ANIMATION_SPEED=100}else{human=new HumanPlayer("You")}human.top=BOTTOM_PLAYER_TOP;human.left=BOTTOM_PLAYER_LEFT;human.align=HORIZONTAL;human.position=BOTTOM;human.showCards=true;human.isHuman=true;human.id="bottom-player";human.imgIndex=0;var e=parseInt($.cookie("player-image"));if(e&&e>3&&e<=13){human.imgIndex=e}this._createPlayerImgAndName(human);$("#bottom-player small").text(human.alias||human.name);human.wrongCardPressed=function(e){trackEvent("Game","ClickWrongCard",e)}},_createPlayerImgAndName:function(e){$("#"+e.id+" small").text(e.alias||e.name);$("<div/>").sprite(e.imgIndex,50).prependTo($("#"+e.id));$("span#"+e.id+"-win").sprite(e.imgIndex,120)},createComputerPlayers:function(){topPlayer=new ComputerPlayer("Player 2");topPlayer.top=TOP_PLAYER_TOP;topPlayer.left=TOP_PLAYER_LEFT;topPlayer.align=HORIZONTAL;topPlayer.position=TOP;topPlayer.id="top-player";topPlayer.imgIndex=2;this._createPlayerImgAndName(topPlayer);leftPlayer=new ComputerPlayer("Player 1");leftPlayer.top=LEFT_PLAYER_TOP;leftPlayer.left=LEFT_PLAYER_LEFT;leftPlayer.align=VERTICAL;leftPlayer.position=LEFT;leftPlayer.id="left-player";leftPlayer.imgIndex=1;this._createPlayerImgAndName(leftPlayer);rightPlayer=new ComputerPlayer("Player 3");rightPlayer.top=RIGHT_PLAYER_TOP;rightPlayer.left=RIGHT_PLAYER_LEFT;rightPlayer.align=VERTICAL;rightPlayer.position=RIGHT;rightPlayer.id="right-player";rightPlayer.imgIndex=3;this._createPlayerImgAndName(rightPlayer)},setEventRenderers:function(){for(var e in game.renderers){game.setEventRenderer(e,function(e){e.callback()})}game.setEventRenderer("deckready",webRenderer.deckReady);game.setEventRenderer("dealcard",webRenderer.dealCard);game.setEventRenderer("selectcard",webRenderer.selectCard);game.setEventRenderer("unselectcard",webRenderer.unselectCard);game.setEventRenderer("play",webRenderer.play);game.setEventRenderer("draw",webRenderer.draw);game.setEventRenderer("pass",webRenderer.pass);game.setEventRenderer("sorthand",webRenderer.sortHand)},setupOpponentClickTracking:function(){$(".player-pic").click(function(){trackEvent("Game","ClickPlayer",$(this).attr("id"))})},setupSortHandler:function(){$("#sortHand").click(function(){try{if(!window.human.canPlay){game.message("You can only sort when it is your turn to play.");trackEvent("Game","SortCards","Failure")}else{game.sortHand(window.human,function(){});trackEvent("Game","SortCards","Success")}}catch(e){handleError(e)}})},setupPlayerCountHandler:function(){window.playerCount=game.defaultPlayerCount;if(playerCount>2){$("#left-player").show()}if(playerCount==4){$("#right-player").show()}var e=$("#player-count")[0];if(e){e.options[playerCount-2].selected="selected"}$("#player-count").change(function(){window.playerCount=this.selectedIndex+2;if(playerCount==4){$("#right-player").fadeIn();$("#left-player").fadeIn()}if(playerCount==3){$("#right-player").fadeOut();$("#left-player").fadeIn()}if(playerCount==2){$("#right-player").fadeOut();$("#left-player").fadeOut()}})},bindCardEventHandlers:function(){$(".card").mousedown(function(e){if(errorHandling){try{human.useCard(this.card,e.which==3||e.metaKey)}catch(t){handleError(t)}}else{human.useCard(this.card,e.which==3||e.metaKey)}});$(".card").bind("contextmenu",function(e){return false})},setupStartHandler:function(){game.setEventRenderer("start",function(e){$("#sortHand").show();webGame.bindCardEventHandlers();if(webRenderer.start){webRenderer.start(e)}else{e.callback()}})},setupTurnHandler:function(){game.setEventRenderer("playerturn",function(e){if(e.player.isHuman){if(e.game.round<=3){var t="Your go. Play a card";if(game.canSelectCards){t+=" Right click to select multiple cards."}e.game.message(t)}else{e.game.message("Your turn!")}}else{e.game.message(e.player.name+"'s turn!")}e.callback()})},setupDealHandler:function(){$("#deal").click(function(e){try{game.addPlayer(human);if(playerCount>2){game.addPlayer(leftPlayer)}game.addPlayer(topPlayer);if(playerCount==4){game.addPlayer(rightPlayer)}game.message("");game.deal();$("#deal").hide();$("#open-player-picker").hide();$("#player-count").hide();trackEvent("Game","Deal",playerCount+" players",playerCount)}catch(e){handleError(e)}})},setupRestartHandler:function(){$("#start-new-game").click(function(e){trackEvent("Game","Restart",result);location.reload()})},setupMessageHandler:function(){game.message=function(e){$("#message_box p").html(e)}},setupWinHandler:function(){game.setEventRenderer("win",function(e){trackEvent("Game","Win",e.player.name);for(var t=0;t<game.pile.length;t++){$(game.pile[t].guiCard).hide()}for(var t=0;t<game.deck.length;t++){$(game.deck[t].guiCard).hide()}window.zIndexCounter++;if(e.player.isHuman){$("#result-box h3").text("CONGRATULATIONS! YOU WIN!");result="Win"}else{$("#result-box h3").text(e.player.name.toUpperCase()+" WINS!!!");result="Lose"}$("#result-box span.winner-img").css("display","none");$("#result-box span#"+e.player.id+"-win").css({display:"inline-block",width:120,height:120});$("#message_box").hide();$("#result-box").css("z-index",zIndexCounter).show()})},setupLogging:function(){if(location.search&&location.search.indexOf("log")!=-1){window.log=function(e){for(var t=1;t<arguments.length;t++){e=e.replace("%"+t,arguments[t])}if(this.console){this.console.log(e)}}}},startGame:function(){try{game.start()}catch(e){handleError(e)}},extraSetup:function(){},extend:function(e){for(var t in this){if(!e[t]){e[t]=this[t]}}e.base=this}};$(document).ready(function(){try{loadSocialScripts();webGame.initPageNavigation();webGame.setupLogging();window.game=webGame.createGameObject();webGame.setupPlayerPicker();webGame.createHumanPlayer();webGame.createComputerPlayers();webGame.setEventRenderers();webGame.setupOpponentClickTracking();webGame.setupSortHandler();webGame.setupPlayerCountHandler();webGame.setupDealHandler();webGame.setupRestartHandler();webGame.setupWinHandler();webGame.setupStartHandler();webGame.setupTurnHandler();webGame.setupMessageHandler();webGame.extraSetup();webGame.startGame()}catch(e){handleError(e)}});var appCache=window.applicationCache;if(appCache&&appCache.addEventListener){appCache.addEventListener("error",function(){$("#authorpic img").attr("src","images/author.jpg");$("#promo-footer").hide()},false)}if(document.referrer&&document.referrer.length){if(document.location.href.substr(0,25)!=document.referrer.substr(0,25)){trackEvent("Traffic","Visit",document.referrer)}}WebSpades.prototype={createGameObject:function(){return new Spades},setupStartHandler:function(){game.setEventRenderer("start",function(e){if(location.search&&location.search.indexOf("autoplay")!=-1){ANIMATION_SPEED=100;TAKE_TRICK_DELAY=100}if(window.results){for(var t=0;t<game.players.length;t++){game.players[t].scoreLastRound=window.results[t*2];game.players[t].bags=window.results[t*2+1]}}webGame.bindCardEventHandlers();$(".bubble").fadeOut();e.callback()})},extraSetup:function(){game.setEventRenderer("taketrick",webRenderer.takeTrick);game.setEventRenderer("bid",webRenderer.bid);game.setEventRenderer("showscore",function(e){var t=[];var n=[e.team1,e.team2,e.team1,e.team2];for(var r=0;r<game.players.length;r++){t.push(n[r].scoreTotal);t.push(n[r].bagsNextRound)}$.cookie("results",""+t);window.result=e.team1.scoreTotal>e.team2.scoreTotal?"Win":"Lose";trackEvent("Statistics","ScoreAverage","You & Mr. Carter",e.team1.score);trackEvent("Statistics","ScoreAverage","Bush & Putin",e.team2.score);trackEvent("Statistics","TrickDeviation","You & Mr. Carter",e.team1.tricks-e.team1.bid);trackEvent("Statistics","TrickDeviation","Bush & Putin",e.team2.tricks-e.team2.bid);webRenderer.showScore(e)});game.setEventRenderer("win",function(e){$.cookie("results","");window.result=e.team1.scoreTotal>e.team2.scoreTotal?"Win":"Lose";trackEvent("Statistics","ScoreAverage","You & Mr. Carter",e.team1.score);trackEvent("Statistics","ScoreAverage","Bush & Putin",e.team2.score);trackEvent("Statistics","WinPercentage","You & Mr. Carter",result=="Win"?100:0);trackEvent("Statistics","WinPercentage","Bush & Putin",result=="Win"?0:100);trackEvent("Statistics","TrickDeviation","You & Mr. Carter",e.team1.tricks-e.team1.bid);trackEvent("Statistics","TrickDeviation","Bush & Putin",e.team2.tricks-e.team2.bid);webRenderer.showScore(e)});game.setEventRenderer("spadesbroken",webRenderer.spadesBroken);var e=["horizontal-trick","vertical-trick","spade-large"];var t=new Image;for(var n=0;n<e.length;n++){t.src="images/"+e[n]+".png"}$("#reset-game").click(function(){if(confirm("This will erase all the scores and start a completely new game. Are you sure you want to do that?")){$.cookie("results","");window.document.location.reload()}});$("#start-new-tournament").click(function(){$.cookie("results","");window.document.location.reload()});window.results=[];var r=$.cookie("results");if(r){var i=r.split(",");for(var n=0;n<i.length;n++){results.push(parseFloat(i[n]))}}human.startBid=function(e){$("#bid-div").css("z-index",zIndexCounter+1e4).show();var t="How many tricks do you think you'll be able to take?";window.game.message(t);for(var n=0;n<=e;n++){$("<span/>").text(n).appendTo("#bid-div > div").click(function(){human.doBid(parseInt($(this).text()));$("#bid-div").hide();game.message("")}).mouseover(function(){game.message("Bid "+$(this).text())}).mouseout(function(){game.message("")})}}}};errorHandling=true;WebCardGame.prototype.extend(WebSpades.prototype);window.webGame=new WebSpades;jQuery.cookie=function(e,t,n){if(typeof t!="undefined"){n=n||{};if(t===null){t="";n.expires=-1}var r="";if(n.expires&&(typeof n.expires=="number"||n.expires.toUTCString)){var i;if(typeof n.expires=="number"){i=new Date;i.setTime(i.getTime()+n.expires*24*60*60*1e3)}else{i=n.expires}r="; expires="+i.toUTCString()}var s=n.path?"; path="+n.path:"";var o=n.domain?"; domain="+n.domain:"";var u=n.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),r,s,o,u].join("")}else{var a=null;if(document.cookie&&document.cookie!=""){var f=document.cookie.split(";");for(var l=0;l<f.length;l++){var c=jQuery.trim(f[l]);if(c.substring(0,e.length+1)==e+"="){a=decodeURIComponent(c.substring(e.length+1));break}}}return a}}